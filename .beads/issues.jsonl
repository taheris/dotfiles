{"id":"df-917","title":"Apple Pro Display XDR brightness control","status":"closed","priority":2,"issue_type":"feature","owner":"gpg@taheris.net","created_at":"2026-01-21T21:55:22.562054163Z","created_by":"unknown","updated_at":"2026-01-21T21:55:32.472791589Z","closed_at":"2026-01-21T21:55:32.472791589Z","close_reason":"Implemented Apple Pro Display XDR brightness control via custom HID kernel driver.\n\n## Changes\n- `packages/apple-display-backlight/apple_bl_usb.c` - HID driver that:\n  - Claims interface 2 for brightness control (range 0-49600)\n  - Claims interface 4 silently to suppress HID parse warnings\n  - Creates `/sys/class/backlight/apple_xdr_display`\n- `packages/apple-display-backlight/default.nix` - Nix derivation\n- `packages/apple-display-backlight/Makefile` - Build file\n- `packages/default.nix` - Added package\n- `nixos/hardware-configuration.nix`:\n  - Removed `usbhid.quirks=0x05ac:0x9243:0x0004` (was blocking HID enumeration)\n  - Added `apple_bl_usb` to kernelModules (loads before hid-generic)\n  - Added extraModulePackages with the driver\n- `nixos/configuration.nix` - Added udev rule for non-root brightness control\n\n## Testing\n- Brightness control works: `echo 25000 \u003e /sys/class/backlight/apple_xdr_display/brightness`\n- Module loads and claims interfaces correctly\n- Pending: verify boot warnings gone after reboot\n\n## If issues after reboot\n- Check `dmesg | grep -i apple` for errors\n- Verify `/sys/class/backlight/apple_xdr_display` exists\n- If warnings persist, module may not be loading early enough"}
